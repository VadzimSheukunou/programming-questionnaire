{"version":3,"sources":["../src/app.js"],"names":["app","apiVersion","use","swaggerUi","serve","setup","swaggerDocument","bodyParser","json","urlencoded","extended","parseQueryParams","parseCookie","routes","user","authorization","answer","progress","question","questionnaire","req","res","next","status","err","Error","JSON","stringify","parsedQuery","href","send","error","message","alterDatabaseOnSync","eraseDatabaseOnSync","sequelize","sync","force","alter","then","listen","process","env","PORT","console","log"],"mappings":";;;;;;;;;;AAAA;;AACA;;AACA;;AACA;;AACA;;AACA;;AAEA;;AAIA;;AACA;;AAEA,IAAMA,GAAG,GAAG,0BAAZ;AACA,IAAMC,UAAU,GAAG,IAAnB,C,CAEA;;AACAD,GAAG,CAACE,GAAJ,CAAQ,WAAR,EAAqBC,SAAS,CAACC,KAA/B,EAAsCD,SAAS,CAACE,KAAV,CAAgBC,eAAhB,CAAtC,E,CAEA;;AACAN,GAAG,CAACE,GAAJ,CAAQ,uBAAR;AACAF,GAAG,CAACE,GAAJ,CAAQK,uBAAWC,IAAX,EAAR;AACAR,GAAG,CAACE,GAAJ,CAAQK,uBAAWE,UAAX,CAAsB;AAAEC,EAAAA,QAAQ,EAAE;AAAZ,CAAtB,CAAR;AACAV,GAAG,CAACE,GAAJ,CAAQS,6BAAR;AACAX,GAAG,CAACE,GAAJ,CAAQU,wBAAR,E,CAEA;;AACAZ,GAAG,CAACE,GAAJ,gBAAgBD,UAAhB,YAAmCY,mBAAOC,IAA1C;AACAd,GAAG,CAACE,GAAJ,gBAAgBD,UAAhB,YAAmCY,mBAAOE,aAA1C;AACAf,GAAG,CAACE,GAAJ,gBAAgBD,UAAhB,cAAqCY,mBAAOG,MAA5C;AACAhB,GAAG,CAACE,GAAJ,gBAAgBD,UAAhB,gBAAuCY,mBAAOI,QAA9C;AACAjB,GAAG,CAACE,GAAJ,gBAAgBD,UAAhB,gBAAuCY,mBAAOK,QAA9C;AACAlB,GAAG,CAACE,GAAJ,gBAAgBD,UAAhB,qBAA4CY,mBAAOM,aAAnD,E,CAEA;;AACAnB,GAAG,CAACE,GAAJ,CAAQ,cAAR,EAAwB,UAACkB,GAAD,EAAMC,GAAN,EAAWC,IAAX,EAAoB;AAC1CD,EAAAA,GAAG,CAACb,IAAJ,CAAS;AAAEe,IAAAA,MAAM,EAAE;AAAV,GAAT;AACD,CAFD,E,CAIA;;AACAvB,GAAG,CAACE,GAAJ,CAAQ,UAACkB,GAAD,EAAMC,GAAN,EAAWC,IAAX,EAAoB;AAC1B,MAAME,GAAG,GAAG,IAAIC,KAAJ,4BAA8BC,IAAI,CAACC,SAAL,CAAeP,GAAG,CAACQ,WAAJ,CAAgBC,IAA/B,CAA9B,EAAZ;AACAR,EAAAA,GAAG,CAACE,MAAJ,CAAW,GAAX,EAAgBO,IAAhB,CAAqB;AAAEC,IAAAA,KAAK,EAAEP,GAAG,CAACQ;AAAb,GAArB;AACD,CAHD;AAKA,IAAMC,mBAAmB,GAAG,IAA5B;AACA,IAAMC,mBAAmB,GAAG,KAA5B,C,CAAmC;;AACnCC,oBAAUC,IAAV,CAAe;AAAEC,EAAAA,KAAK,EAAEH,mBAAT;AAA8BI,EAAAA,KAAK,EAAEL;AAArC,CAAf,EAA2EM,IAA3E;AAAA;AAAA;AAAA;AAAA,6BAAgF;AAAA;AAAA;AAAA;AAAA;AAC9E,cAAIL,mBAAJ,EAAyB,CACvB;AACD;;AAEDlC,UAAAA,GAAG,CAACwC,MAAJ,CAAWC,OAAO,CAACC,GAAR,CAAYC,IAAvB,EAA6B;AAAA,mBAC3BC,OAAO,CAACC,GAAR,iCAAqCJ,OAAO,CAACC,GAAR,CAAYC,IAAjD,EAD2B;AAAA,WAA7B;;AAL8E;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,CAAhF","sourcesContent":["import 'dotenv/config';\r\nimport cors from 'cors';\r\nimport bodyParser from 'body-parser';\r\nimport express from 'express';\r\nimport * as swaggerUi from 'swagger-ui-express';\r\nimport * as swaggerDocument from '../swagger/swagger.json';\r\n\r\nimport {\r\n  parseQueryParams,\r\n  parseCookie\r\n} from './middlewares';\r\nimport { sequelize } from './db-models';\r\nimport routes from './routes';\r\n\r\nconst app = express();\r\nconst apiVersion = 'v1';\r\n\r\n// Swagger Docs\r\napp.use('/api-docs', swaggerUi.serve, swaggerUi.setup(swaggerDocument));\r\n\r\n// Middlewares\r\napp.use(cors());\r\napp.use(bodyParser.json());\r\napp.use(bodyParser.urlencoded({ extended: true }));\r\napp.use(parseQueryParams);\r\napp.use(parseCookie);\r\n\r\n// Routes\r\napp.use(`/api/${apiVersion}/user`, routes.user);\r\napp.use(`/api/${apiVersion}/auth`, routes.authorization);\r\napp.use(`/api/${apiVersion}/answer`, routes.answer);\r\napp.use(`/api/${apiVersion}/progress`, routes.progress);\r\napp.use(`/api/${apiVersion}/question`, routes.question);\r\napp.use(`/api/${apiVersion}/questionnaire`, routes.questionnaire);\r\n\r\n// Healthcheck endpoint\r\napp.use('/healthcheck', (req, res, next) => {\r\n  res.json({ status: 'UP' });\r\n});\r\n\r\n// Handle no route request\r\napp.use((req, res, next) => {\r\n  const err = new Error(`Page Not Found - ${JSON.stringify(req.parsedQuery.href)}`);\r\n  res.status(404).send({ error: err.message });\r\n});\r\n\r\nconst alterDatabaseOnSync = true;\r\nconst eraseDatabaseOnSync = false; // if enabled, drops all tables and data on sync\r\nsequelize.sync({ force: eraseDatabaseOnSync, alter: alterDatabaseOnSync }).then(async () => {\r\n  if (eraseDatabaseOnSync) {\r\n    // erase tables data\r\n  }\r\n\r\n  app.listen(process.env.PORT, () =>\r\n    console.log(`App listening on port ${process.env.PORT}`),\r\n  );\r\n});\r\n"],"file":"app.js"}